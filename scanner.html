<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background:#f4f6f9; margin:0; padding:0; }
    h1 { background:#2e86de; color:white; padding:15px; margin:0; }
    #reader { width: 90%; max-width: 400px; margin: 20px auto; }
    #error { color: red; margin-top: 10px; font-weight: bold; padding: 0 12px 18px; white-space: pre-line; }
    button { font-size: 18px; padding: 12px 16px; border:none; border-radius:12px; cursor:pointer; }
  </style>
</head>
<body>
  <h1>ðŸ“· Escanea tu credencial ISIC</h1>

  <div style="margin:14px;">
    <button id="startBtn">Iniciar cÃ¡mara</button>
  </div>

  <div id="reader"></div>
  <div id="error"></div>

  <script>
    const APPS_SCRIPT_LOG_URL = "https://script.google.com/macros/s/AKfycbynJ2qmcmAINuZGYMNpSZ9JNz9OUPkFrhc3WlYEddOMMBrJAswIQXKZ8e6oz-hrPCKo/exec"; // <-- put your web app exec URL here

    const html5QrCode = new Html5Qrcode("reader");
    let running = false;

    function showError(msg) {
      document.getElementById("error").innerText = msg || "";
    }

    function onScanSuccess(decodedText) {
      // decodedText is the ISIC number (from ISIC app QR)
      const isic = String(decodedText).trim();

      // Go to Apps Script to log + show success screen, then it returns here automatically
      window.location.href = `${APPS_SCRIPT_LOG_URL}?isic=${encodeURIComponent(isic)}`;
    }

    async function start() {
      showError("");
      if (running) return;

      try {
        await html5QrCode.start(
          { facingMode: "environment" },
          { fps: 10, qrbox: 250 },
          onScanSuccess
        );
        running = true;
        document.getElementById("startBtn").style.display = "none";
      } catch (e) {
        showError("No se pudo abrir la cÃ¡mara. Verifica permisos del navegador.");
      }
    }

    document.getElementById("startBtn").addEventListener("click", start);
  </script>
</body>
</html>
